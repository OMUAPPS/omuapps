const characters = [
    '\u00ad',
    '\u034f',
    '\u061c',
    '\u17b4',
    '\u17b5',
    '\u180b',
    '\u180c',
    '\u180d',
    '\u180e',
    '\u2004',
    '\u2005',
    '\u2006',
    '\u2009',
    '\u200a',
    '\u200b',
    '\u200c',
    '\u200d',
    '\u200e',
    '\u200f',
    '\u202a',
    '\u202b',
    '\u202c',
    '\u202d',
    '\u202f',
    '\u205f',
    '\u2060',
    '\u2061',
    '\u2062',
    '\u2063',
    '\u2064',
    '\u2065',
    '\u2066',
    '\u2067',
    '\u2068',
    '\u2069',
    '\u206a',
    '\u206b',
    '\u206c',
    '\u206d',
    '\u206e',
    '\u206f',
    '\ufe00',
    '\ufe01',
    '\ufe02',
    '\ufe03',
    '\ufe04',
    '\ufe05',
    '\ufe06',
    '\ufe07',
    '\ufe08',
    '\ufe09',
    '\ufe0a',
    '\ufe0b',
    '\ufe0c',
    '\ufe0d',
    '\ufe0e',
    '\ud834\udd73',
    '\ud834\udd74',
    '\ud834\udd75',
    '\ud834\udd76',
    '\ud834\udd77',
    '\ud834\udd78',
    '\ud834\udd79',
    '\ud834\udd7a',
    '\udb40\udc01',
    '\udb40\udc20',
    '\udb40\udc21',
    '\udb40\udc22',
    '\udb40\udc23',
    '\udb40\udc24',
    '\udb40\udc25',
    '\udb40\udc26',
    '\udb40\udc27',
    '\udb40\udc28',
    '\udb40\udc29',
    '\udb40\udc2a',
    '\udb40\udc2b',
    '\udb40\udc2c',
    '\udb40\udc2d',
    '\udb40\udc2e',
    '\udb40\udc2f',
    '\udb40\udc30',
    '\udb40\udc31',
    '\udb40\udc32',
    '\udb40\udc33',
    '\udb40\udc34',
    '\udb40\udc35',
    '\udb40\udc36',
    '\udb40\udc37',
    '\udb40\udc38',
    '\udb40\udc39',
    '\udb40\udc3a',
    '\udb40\udc3b',
    '\udb40\udc3c',
    '\udb40\udc3d',
    '\udb40\udc3e',
    '\udb40\udc3f',
    '\udb40\udc40',
    '\udb40\udc41',
    '\udb40\udc42',
    '\udb40\udc43',
    '\udb40\udc44',
    '\udb40\udc45',
    '\udb40\udc46',
    '\udb40\udc47',
    '\udb40\udc48',
    '\udb40\udc49',
    '\udb40\udc4a',
    '\udb40\udc4b',
    '\udb40\udc4c',
    '\udb40\udc4d',
    '\udb40\udc4e',
    '\udb40\udc4f',
    '\udb40\udc50',
    '\udb40\udc51',
    '\udb40\udc52',
    '\udb40\udc53',
    '\udb40\udc54',
    '\udb40\udc55',
    '\udb40\udc56',
    '\udb40\udc57',
    '\udb40\udc58',
    '\udb40\udc59',
    '\udb40\udc5a',
    '\udb40\udc5b',
    '\udb40\udc5c',
    '\udb40\udc5d',
    '\udb40\udc5e',
    '\udb40\udc5f',
    '\udb40\udc60',
    '\udb40\udc61',
    '\udb40\udc62',
    '\udb40\udc63',
    '\udb40\udc64',
    '\udb40\udc65',
    '\udb40\udc66',
    '\udb40\udc67',
    '\udb40\udc68',
    '\udb40\udc69',
    '\udb40\udc6a',
    '\udb40\udc6b',
    '\udb40\udc6c',
    '\udb40\udc6d',
    '\udb40\udc6e',
    '\udb40\udc6f',
    '\udb40\udc70',
    '\udb40\udc71',
    '\udb40\udc72',
    '\udb40\udc73',
    '\udb40\udc74',
    '\udb40\udc75',
    '\udb40\udc76',
    '\udb40\udc77',
    '\udb40\udc78',
    '\udb40\udc79',
    '\udb40\udc7a',
    '\udb40\udc7b',
    '\udb40\udc7c',
    '\udb40\udc7d',
    '\udb40\udc7e',
    '\udb40\udc7f',
    '\udb40\udd00',
    '\udb40\udd01',
    '\udb40\udd02',
    '\udb40\udd03',
    '\udb40\udd04',
    '\udb40\udd05',
    '\udb40\udd06',
    '\udb40\udd07',
    '\udb40\udd08',
    '\udb40\udd09',
    '\udb40\udd0a',
    '\udb40\udd0b',
    '\udb40\udd0c',
    '\udb40\udd0d',
    '\udb40\udd0e',
    '\udb40\udd0f',
    '\udb40\udd10',
    '\udb40\udd11',
    '\udb40\udd12',
    '\udb40\udd13',
    '\udb40\udd14',
    '\udb40\udd15',
    '\udb40\udd16',
    '\udb40\udd17',
    '\udb40\udd18',
    '\udb40\udd19',
    '\udb40\udd1a',
    '\udb40\udd1b',
    '\udb40\udd1c',
    '\udb40\udd1d',
    '\udb40\udd1e',
    '\udb40\udd1f',
    '\udb40\udd20',
    '\udb40\udd21',
    '\udb40\udd22',
    '\udb40\udd23',
    '\udb40\udd24',
    '\udb40\udd25',
    '\udb40\udd26',
    '\udb40\udd27',
    '\udb40\udd28',
    '\udb40\udd29',
    '\udb40\udd2a',
    '\udb40\udd2b',
    '\udb40\udd2c',
    '\udb40\udd2d',
    '\udb40\udd2e',
    '\udb40\udd2f',
    '\udb40\udd30',
    '\udb40\udd31',
    '\udb40\udd32',
    '\udb40\udd33',
    '\udb40\udd34',
    '\udb40\udd35',
    '\udb40\udd36',
    '\udb40\udd37',
    '\udb40\udd38',
    '\udb40\udd39',
    '\udb40\udd3a',
    '\udb40\udd3b',
    '\udb40\udd3c',
    '\udb40\udd3d',
    '\udb40\udd3e',
    '\udb40\udd3f',
    '\udb40\udd40',
    '\udb40\udd41',
    '\udb40\udd42',
    '\udb40\udd43',
    '\udb40\udd44',
    '\udb40\udd45',
    '\udb40\udd46',
    '\udb40\udd47',
    '\udb40\udd48',
    '\udb40\udd49',
    '\udb40\udd4a',
    '\udb40\udd4b',
    '\udb40\udd4c',
    '\udb40\udd4d',
    '\udb40\udd4e',
    '\udb40\udd4f',
    '\udb40\udd50',
    '\udb40\udd51',
    '\udb40\udd52',
    '\udb40\udd53',
    '\udb40\udd54',
    '\udb40\udd55',
    '\udb40\udd56',
    '\udb40\udd57',
    '\udb40\udd58',
    '\udb40\udd59',
    '\udb40\udd5a',
    '\udb40\udd5b',
    '\udb40\udd5c',
    '\udb40\udd5d',
    '\udb40\udd5e',
    '\udb40\udd5f',
    '\udb40\udd60',
    '\udb40\udd61',
    '\udb40\udd62',
    '\udb40\udd63',
    '\udb40\udd64',
    '\udb40\udd65',
    '\udb40\udd66',
    '\udb40\udd67',
    '\udb40\udd68',
    '\udb40\udd69',
    '\udb40\udd6a',
    '\udb40\udd6b',
    '\udb40\udd6c',
    '\udb40\udd6d',
    '\udb40\udd6e',
    '\udb40\udd6f',
    '\udb40\udd70',
    '\udb40\udd71',
    '\udb40\udd72',
    '\udb40\udd73',
    '\udb40\udd74',
    '\udb40\udd75',
    '\udb40\udd76',
    '\udb40\udd77',
    '\udb40\udd78',
    '\udb40\udd79',
    '\udb40\udd7a',
    '\udb40\udd7b',
    '\udb40\udd7c',
    '\udb40\udd7d',
    '\udb40\udd7e',
    '\udb40\udd7f',
    '\udb40\udd80',
    '\udb40\udd81',
    '\udb40\udd82',
    '\udb40\udd83',
    '\udb40\udd84',
    '\udb40\udd85',
    '\udb40\udd86',
    '\udb40\udd87',
    '\udb40\udd88',
    '\udb40\udd89',
    '\udb40\udd8a',
    '\udb40\udd8b',
    '\udb40\udd8c',
    '\udb40\udd8d',
    '\udb40\udd8e',
    '\udb40\udd8f',
    '\udb40\udd90',
    '\udb40\udd91',
    '\udb40\udd92',
    '\udb40\udd93',
    '\udb40\udd94',
    '\udb40\udd95',
    '\udb40\udd96',
    '\udb40\udd97',
    '\udb40\udd98',
    '\udb40\udd99',
    '\udb40\udd9a',
    '\udb40\udd9b',
    '\udb40\udd9c',
    '\udb40\udd9d',
    '\udb40\udd9e',
    '\udb40\udd9f',
    '\udb40\udda0',
    '\udb40\udda1',
    '\udb40\udda2',
    '\udb40\udda3',
    '\udb40\udda4',
    '\udb40\udda5',
    '\udb40\udda6',
    '\udb40\udda7',
    '\udb40\udda8',
    '\udb40\udda9',
    '\udb40\uddaa',
    '\udb40\uddab',
    '\udb40\uddac',
    '\udb40\uddad',
    '\udb40\uddae',
    '\udb40\uddaf',
    '\udb40\uddb0',
    '\udb40\uddb1',
    '\udb40\uddb2',
    '\udb40\uddb3',
    '\udb40\uddb4',
    '\udb40\uddb5',
    '\udb40\uddb6',
    '\udb40\uddb7',
    '\udb40\uddb8',
    '\udb40\uddb9',
    '\udb40\uddba',
    '\udb40\uddbb',
    '\udb40\uddbc',
    '\udb40\uddbd',
    '\udb40\uddbe',
    '\udb40\uddbf',
    '\udb40\uddc0',
    '\udb40\uddc1',
    '\udb40\uddc2',
    '\udb40\uddc3',
    '\udb40\uddc4',
    '\udb40\uddc5',
    '\udb40\uddc6',
    '\udb40\uddc7',
    '\udb40\uddc8',
    '\udb40\uddc9',
    '\udb40\uddca',
    '\udb40\uddcb',
    '\udb40\uddcc',
    '\udb40\uddcd',
    '\udb40\uddce',
    '\udb40\uddcf',
    '\udb40\uddd0',
    '\udb40\uddd1',
    '\udb40\uddd2',
    '\udb40\uddd3',
    '\udb40\uddd4',
    '\udb40\uddd5',
    '\udb40\uddd6',
    '\udb40\uddd7',
    '\udb40\uddd8',
    '\udb40\uddd9',
    '\udb40\uddda',
    '\udb40\udddb',
    '\udb40\udddc',
    '\udb40\udddd',
    '\udb40\uddde',
    '\udb40\udddf',
    '\udb40\udde0',
    '\udb40\udde1',
    '\udb40\udde2',
    '\udb40\udde3',
    '\udb40\udde4',
    '\udb40\udde5',
    '\udb40\udde6',
    '\udb40\udde7',
    '\udb40\udde8',
    '\udb40\udde9',
    '\udb40\uddea',
    '\udb40\uddeb',
    '\udb40\uddec',
    '\udb40\udded',
    '\udb40\uddee',
    '\udb40\uddef',
];

export const unshorten = (s: string): string | null => {
    // Check header
    if (s[0] !== '\u200b') {
        console.error('Invalid header');
        return null;
    }
    s = s.slice(1);
    // Bytes
    const bytes: number[] = [];
    // Surrogate pair buffer
    let surrogateBuffer = '';
    for (let i = 0; i < s.length; i++) {
        let c = s[i];
        if (c >= '\ud800' && c <= '\udbff') {
            surrogateBuffer = c;
            continue;
        } else {
            if (surrogateBuffer) {
                c = surrogateBuffer + c;
                surrogateBuffer = '';
            }
        }
        const index = characters.indexOf(c);
        if (index === -1) {
            console.error(`Character not found in mapping: ${c} (U+${c.charCodeAt(0).toString(16).toUpperCase().padStart(4, '0')})`);
            return null;
        }
        bytes.push(index);
    }
    return new TextDecoder().decode(new Uint8Array(bytes));
};

export const shorten = (s: string): string => {
    const bytes = new TextEncoder().encode(s);
    let result = '';
    // Header
    result += '\u200b';
    for (let i = 0; i < bytes.length; i++) {
        const byte = bytes[i];
        result += characters[byte];
    }
    return result;
};
